/*
 * FHIRWork (c)
 *
 * This work is licensed under the MIT License. To view a copy of this
 * license, visit
 *
 *      https://opensource.org/licenses/MIT
 *
 * Author: Blair Butterworth
 * Author: Alperen Karaoglu
 */

repositories {
    ivy {
        url 'https://github.com/'
        layout 'pattern', {
            artifact '/[organisation]/[module]/archive/[revision].[ext]'
        }
    }
}

configurations {
    growthchart
}

dependencies {
    growthchart 'blairisme:docker-growth-chart:master@zip'
}

task chartExtract() {
  doLast {
    copy {
      def zipPath = project.configurations.growthchart.find {it.name.startsWith('docker-growth-chart') }
      def zipFile = file(zipPath)
      def outputDir = projectDir

      from zipTree(zipFile)
      into outputDir
    }
  }
  outputs.dir file("${projectDir}/docker-growth-chart-master")
}

task chartStart(type: Exec) {
  dependsOn 'chartExtract'
  workingDir 'docker-growth-chart-master'
  commandLine 'docker-compose', 'up', '-d'
}
task chartStartProduction(type: Exec) {
  dependsOn 'chartExtract'
  workingDir 'docker-growth-chart-master'
  commandLine 'docker-compose', '-f', 'docker-compose.yml', '-f', 'production.yml', 'up', '-d'
}

task chartStop(type: Exec){
  workingDir 'docker-growth-chart-master'
  commandLine 'docker-compose', 'stop'
}

task manualTestStart(dependsOn: ['chartStart']){
}

task manualTestStop(dependsOn: ['chartStop']){
}
